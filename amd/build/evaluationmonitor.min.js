/**
 * Evaluation monitoring
 *
 * @copyright 2013 onward Juan Carlos Rodr√≠guez-del-Pino
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @author Juan Carlos Rodr√≠guez-del-Pino <jcrodriguez@dis.ulpgc.es>
 */
define("mod_vpl/evaluationmonitor",["mod_vpl/vplui"],(function(VPLUI){return{init:function(options){function showErrorMessage(message){VPLUI.showErrorMessage(message,{next:options.next})}var action;options.next=function(){window.location=options.nexturl};var executionActions={ajaxurl:options.ajaxurl,run:showErrorMessage,getLastAction:function(){action()}};(action=function(){VPLUI.requestAction("evaluate","evaluating",{},options.ajaxurl).done((function(response){VPLUI.webSocketMonitor(response,"evaluate","evaluating",executionActions).done(options.next).fail(showErrorMessage)})).fail(showErrorMessage)})()},multievaluation:function(options){var baseurl=options.baseurl,goon=!0;function getGrade(result){return void 0===result||void 0===result.grade||null===result.grade?"‚õî":"üëâ "+result.grade}async function evaluateStudent(id,subid){var ajaxurl=baseurl+id+"&action=";return new Promise(((resolve,reject)=>{var action,ok=()=>{resolve(!0)},cancel=()=>{VPL.updatesublist(subid,getGrade()),goon=!1,reject(!1)},showErrorMessage=function(message){VPLUI.showErrorMessage(message,{closeOnEscape:!1,close:function(){VPL.unhlrow(subid)},stop:cancel,next:function(){VPL.updatesublist(subid,getGrade()),ok()}})},executionActions={ajaxurl:ajaxurl,run:showErrorMessage,setResult:function(result){VPL.updatesublist(subid,getGrade(result))},getLastAction:function(){action()}};(action=function(){VPL.hlrow(subid),VPLUI.requestAction("evaluate","evaluating",{},ajaxurl).done((function(response){VPLUI.webSocketMonitor(response,"evaluate","evaluating",executionActions).done(ok).fail(showErrorMessage)})).fail(showErrorMessage)})()}))}!async function(){for(var students=VPL.evaluateStudents,nstudents=students.length,i=0;i<nstudents;i++){var student=students[i];0===i&&VPL.hideTableRows(student.subid),VPL.getTableRow(student.subid).querySelector("td").innerHTML=i+1+"/"+nstudents,VPL.showTableRow(student.subid);try{await evaluateStudent(student.id,student.subid)}catch(e){if(VPL.unhlrow(student.subid),VPL.updatesublist(student.subid,getGrade()),!goon)break}}}()}}}));

//# sourceMappingURL=evaluationmonitor.min.js.map