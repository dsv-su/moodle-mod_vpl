{"version":3,"file":"vplide.min.js","sources":["../src/vplide.js"],"sourcesContent":["// This file is part of VPL for Moodle - http://vpl.dis.ulpgc.es/\n//\n// VPL for Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// VPL for Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with VPL for Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * IDE Control\n *\n * @copyright 2017 Juan Carlos Rodríguez-del-Pino\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author Juan Carlos Rodríguez-del-Pino <jcrodriguez@dis.ulpgc.es>\n */\n\n/* globals openpopup */\n\ndefine(\n    [\n        'jquery',\n        'jqueryui',\n        'core/url',\n        'mod_vpl/vplutil',\n        'mod_vpl/vplui',\n        'mod_vpl/vplidefile',\n        'mod_vpl/vplidebutton',\n        'mod_vpl/vplterminal',\n        'mod_vpl/vplvnc',\n    ],\n    function($, jqui, coreURL, VPLUtil, VPLUI, VPLFile, VPLIDEButtons, VPLTerminal, VPLVNCClient) {\n        if (typeof VPLIDE !== 'undefined') {\n            return VPLIDE;\n        }\n        var vplIdeInstance;\n        var VPLIDE = function(rootId, options) {\n            var self = this;\n            var fileManager;\n            var adjustTabsTitles;\n            var autoResizeTab;\n            var showErrorMessage;\n            var updateMenu;\n            var executionActions;\n            var minNumberOfFiles = options.minfiles || 0;\n            var maxNumberOfFiles = options.maxfiles || 0;\n            var restrictedEdit = options.restrictededitor || options.example;\n            var readOnly = options.example;\n            var readOnlyFiles = options.readOnlyFiles;\n            var isTeacher = options.isTeacher;\n            var fullScreen = false;\n            var scrollBarWidth = VPLUI.scrollBarWidth();\n            var str = VPLUtil.str;\n            var rootObj = $('#' + rootId);\n            $(\"head\").append('<meta name=\"viewport\" content=\"initial-scale=1\">')\n                          .append('<meta name=\"viewport\" width=\"device-width\">')\n                          .append('<link rel=\"stylesheet\" href=\"' + coreURL.relativeUrl('/mod/vpl/editor/VPLIDE.css') + '\"/>');\n            if (typeof rootObj != 'object') {\n                throw new Error(\"VPL: constructor tag_id not found\");\n            }\n            var optionsToCheck = {\n                'new': true,\n                'rename': true,\n                'delete': true,\n                'save': true,\n                'run': true,\n                'edit': true,\n                'debug': true,\n                'evaluate': true,\n                'import': true,\n                'resetfiles': true,\n                'sort': true,\n                'multidelete': true,\n                'showparentfiles': true,\n                'acetheme': true,\n                'console': true,\n                'comments': true\n            };\n            if ((typeof options.loadajaxurl) == 'undefined') {\n                options.loadajaxurl = options.ajaxurl;\n            }\n            (function() {\n                var activateModification = (minNumberOfFiles < maxNumberOfFiles);\n                options.new = activateModification;\n                options.rename = activateModification;\n                options.delete = activateModification;\n                options.comments = options.comments && !options.example;\n                options.acetheme = true;\n            })();\n            options.sort = (maxNumberOfFiles - minNumberOfFiles >= 2);\n            options.multidelete = options.sort;\n            options.import = !restrictedEdit;\n            var isOptionAllowed = function(op) {\n                if (!optionsToCheck[op]) {\n                    return true;\n                }\n                return options[op];\n            };\n            options.console = isOptionAllowed('run') || isOptionAllowed('debug');\n            if ((typeof options.fontSize) == 'undefined') {\n                options.fontSize = 12;\n            }\n            options.fontSize = parseInt(options.fontSize);\n            /**\n             * Handler for dragover event.\n             * @param {object} e event.\n             */\n            function dragoverHandler(e) {\n                if (restrictedEdit) {\n                    e.originalEvent.dataTransfer.dropEffect = 'none';\n                } else {\n                    e.originalEvent.dataTransfer.dropEffect = 'copy';\n                }\n                e.preventDefault();\n            }\n            /**\n             * Handler for drop event.\n             * @param {object} e event.\n             * @returns {boolean}\n             */\n            function dropHandler(e) {\n                if (restrictedEdit) { // No drop allowed.\n                    e.stopImmediatePropagation();\n                    return false;\n                }\n                var droppedFiles = [];\n                // Function that lists all files and subfiles of given entry into droppedFiles.\n                var listDroppedFiles = function(entry, path = '') {\n                    return new Promise(function(resolve) {\n                        if (entry.isFile) {\n                            // Current entry is a file : add it to the list.\n                            entry.file(function(file) {\n                                // Change its name s.t. it preserves directories structure.\n                                var fullName = path + file.name;\n                                Object.defineProperty(file, \"name\", {\n                                    get: function() {\n                                            return fullName;\n                                         }\n                                });\n                                droppedFiles.push(file);\n                                resolve();\n                            });\n                        } else if (entry.isDirectory) {\n                            // Current entry is a directory : process its content.\n                            var dirReader = entry.createReader();\n                            dirReader.readEntries(function(entries) {\n                                var dirPromises = [];\n                                for (var i = 0; i < entries.length; i++) {\n                                    dirPromises.push(listDroppedFiles(entries[i], path + entry.name + \"/\"));\n                                }\n                                Promise.all(dirPromises).then(resolve).catch(function(err) {\n                                    VPLUtil.log(\"Error reading directory entries: \" + err);\n                                });\n                            });\n                        } else {\n                            // This is neither a directory nor a file : ignore it.\n                            resolve();\n                        }\n                    });\n                };\n                var dt = e.originalEvent.dataTransfer;\n\n                // List every element of the drop event.\n                var promises = [];\n                for (var i = 0; i < dt.items.length; i++) {\n                    var entry = dt.items[i].webkitGetAsEntry();\n                    if (!entry) { // Used if testing with Behat\n                        const file = dt.items[i].getAsFile();\n                        if (file) {\n                            // Create a fake entry to handle it like a file.\n                            entry = {\n                                isFile: true,\n                                isDirectory: false,\n                                file: function(callback) {\n                                    callback(file);\n                                }\n                            };\n                            promises.push(listDroppedFiles(entry));\n                        }\n                    } else if (entry.isFile || entry.isDirectory) {\n                        promises.push(listDroppedFiles(entry));\n                    }\n                }\n\n                // Drop files.\n                if (dt.files.length > 0) {\n                    Promise.all(promises)\n                    .then(function() {\n                        VPLUI.readSelectedFiles(droppedFiles, function(file) {\n                            return fileManager.addFile(file, true, updateMenu, showErrorMessage);\n                        },\n                        function() {\n                            fileManager.fileListVisibleIfNeeded();\n                        });\n                        return;\n                    })\n                    .catch(function(err) {\n                        VPLUtil.log(\"Error processing dropped files: \" + err);\n                    });\n\n                    e.stopImmediatePropagation();\n                    return false;\n                }\n                return false;\n            }\n            rootObj.on('drop', dropHandler);\n            rootObj.on('dragover', dragoverHandler);\n            /**\n             * Handler for paste limited by restrictedEdit var.\n             * @param {object} e event.\n             * @returns {boolean}\n             */\n            function restrictedPaste(e) {\n                if (restrictedEdit) {\n                    e.stopPropagation();\n                    return false;\n                }\n                return true;\n            }\n            // Init editor vars.\n            var menu = $('#vpl_menu');\n            var menuButtons = new VPLIDEButtons(menu, isOptionAllowed);\n            var tr = $('#vpl_tr');\n            var fileListContainer = $('#vpl_filelist');\n            var fileList = $('#vpl_filelist_header');\n            var fileListContent = $('#vpl_filelist_content');\n            var tabsUl = $('#vpl_tabs_ul');\n            var tabs = $('#vpl_tabs');\n            var resultContainer = $('#vpl_results');\n            var result = $('#vpl_results_accordion');\n            var renameDiretoryAction = VPLUtil.doNothing;\n            fileListContainer.vplMinWidth = 80;\n            resultContainer.vplMinWidth = 100;\n            /**\n             * Avoids selecting grade.\n             * @param {object} event Unuse.\n             * @param {object} ui UI origen.\n             * @returns {boolean}\n             */\n            function avoidSelectGrade(event, ui) {\n                if (\"newHeader\" in ui) {\n                    if (ui.newHeader.hasClass('vpl_ide_accordion_t_grade')) {\n                        return false;\n                    }\n                }\n                return true;\n            }\n            /**\n             * Constructor of FileManager objects\n             */\n            function FileManager() {\n                var tabsUl = $('#vpl_tabs_ul');\n                $('#vpl_tabs').tabs();\n                var tabs = $('#vpl_tabs').tabs(\"widget\");\n                var files = [];\n                var openFiles = [];\n                var modified = true;\n                var self = this;\n                (function() {\n                    var version;\n                    self.setVersion = function(v) {\n                       version = v;\n                    };\n                    self.getVersion = function() {\n                       return version;\n                    };\n                })();\n                this.updateFileList = function() {\n                    self.generateFileList();\n                };\n                this.fileNameExists = function(name) {\n                    var checkName = name.toLowerCase();\n                    for (var i = 0; i < files.length; i++) {\n                        if (files[i].getFileName().toLowerCase() == checkName) {\n                            return i;\n                        }\n                    }\n                    return -1;\n                };\n                /**\n                 * Checks if name is included in current files names\n                 * @param {string} name Name of file\n                 * @returns {boolean} if found or not found\n                 */\n                function fileNameIncluded(name) {\n                    var checkName = name.toLowerCase() + '/';\n                    for (var i = 0; i < files.length; i++) {\n                        var nameMod = files[i].getFileName().toLowerCase() + '/';\n                        // Check for name as directory existent.\n                        if (nameMod.indexOf(checkName) === 0 || checkName.indexOf(nameMod) === 0) {\n                            return true;\n                        }\n                    }\n                    return false;\n                }\n                /**\n                 * Checks if changing file name results in two blovkly files\n                 * @param {string} oldname The old file name\n                 * @param {string} newname The new file name\n                 * @returns {boolean} if results two two blovkly files\n                 */\n                function twoBlockly(oldname, newname) {\n                    if (VPLUtil.isBlockly(oldname)) {\n                        return false;\n                    }\n                    if (VPLUtil.isBlockly(newname)) {\n                        for (var i = 0; i < files.length; i++) {\n                            if (VPLUtil.isBlockly(files[i].getFileName())) {\n                                return true;\n                            }\n                        }\n                    }\n                    return false;\n                }\n                this.restrictedPaste = restrictedPaste;\n                this.dropHandler = dropHandler;\n                this.dragoverHandler = dragoverHandler;\n                this.readOnly = readOnly;\n                this.readOnlyFiles = readOnlyFiles;\n                this.restrictedEdit = restrictedEdit;\n                this.adjustTabsTitles = adjustTabsTitles;\n                this.minNumberOfFiles = minNumberOfFiles;\n                this.scrollBarWidth = scrollBarWidth;\n                var localClipboard = \"\";\n                this.setClipboard = function(t) {\n                    localClipboard = t;\n                };\n                this.getClipboard = function() {\n                    return localClipboard;\n                };\n                this.getTabPos = function(fileId) {\n                    for (var i = 0; i < openFiles.length; i++) {\n                        if (openFiles[i].getId() == fileId) {\n                            return i;\n                        }\n                    }\n                    return openFiles.length;\n                };\n                this.getTheme = function() {\n                    return options.theme;\n                };\n                this.setTheme = function(theme) {\n                    options.theme = theme;\n                    for (var i = 0; i < files.length; i++) {\n                        files[i].setTheme(theme);\n                    }\n                };\n                this.addTab = function(fid) {\n                    var hlink = '<a href=\"#vpl_file' + fid + '\"></a>';\n                    tabsUl.append('<li id=\"vpl_tab_name' + fid + '\">' + hlink + '</li>');\n                    tabs.append('<div id=\"vpl_file' + fid + '\" class=\"vpl_ide_file\"></div>');\n                };\n                this.removeTab = function(fid) {\n                    tabsUl.find('#vpl_tab_name' + fid).remove();\n                    tabs.find('#vpl_file' + fid).remove();\n                };\n                this.isReadOnly = function(fileName) {\n                    return this.readOnly || this.readOnlyFiles.indexOf(fileName) != -1;\n                };\n                this.open = function(pos) {\n                    var file;\n                    if (typeof pos == 'object') {\n                        file = pos;\n                    } else {\n                        file = files[pos];\n                    }\n                    if (file.isOpen()) {\n                        return;\n                    }\n                    var fid = file.getId();\n                    self.addTab(fid);\n                    openFiles.push(file);\n                    menuButtons.setGetkeys(file.open());\n                    tabs.tabs('refresh');\n                    adjustTabsTitles(false);\n                    VPLUtil.delay('updateFileList', self.updateFileList);\n                    VPLUtil.delay('updateMenu', updateMenu);\n                };\n                this.closeFile = function(file) {\n                    if (!file.isOpen()) {\n                        return;\n                    }\n                    var pos;\n                    var fid = file.getId();\n                    file.close();\n                    VPLUI.hideIDEStatus();\n                    self.removeTab(fid);\n                    var ptab = self.getTabPos(fid);\n                    openFiles.splice(ptab, 1);\n                    tabs.tabs('refresh');\n                    adjustTabsTitles(false);\n                    self.fileListVisible(true);\n                    VPLUtil.delay('updateFileList', self.updateFileList);\n                    VPLUtil.delay('adjustTabsTitles', adjustTabsTitles, false);\n                    if (openFiles.length == ptab) {\n                        ptab--;\n                    }\n                    if (ptab >= 0 && openFiles.length > ptab) {\n                        pos = self.getFilePosById(openFiles[ptab].getId());\n                        self.gotoFile(pos, 'c');\n                        return;\n                    }\n                };\n                this.isClosed = function(pos) {\n                    return !files[pos].isOpen();\n                };\n                this.fileListVisible = function(b) {\n                    if (b === fileListContainer.vplVisible) {\n                        return;\n                    }\n                    if (b) {\n                        VPLUtil.delay('fileListVisible', function() {\n                            fileListContainer.vplVisible = true;\n                            self.updateFileList();\n                            fileListContainer.show();\n                            autoResizeTab();\n                         });\n                    } else {\n                        VPLUtil.delay('fileListVisible', function() {\n                            fileListContainer.vplVisible = false;\n                            fileListContainer.hide();\n                            autoResizeTab();\n                         });\n                    }\n                };\n                this.isFileListVisible = function() {\n                    return fileListContainer.vplVisible;\n                };\n                this.fileListVisibleIfNeeded = function() {\n                    if (this.isFileListVisible()) {\n                        return;\n                    }\n                    for (var i = 0; i < files.length; i++) {\n                        if (!files[i].isOpen()) {\n                            this.fileListVisible(true);\n                            return;\n                        }\n                    }\n                };\n                this.setFontSize = function(size) {\n                    options.fontSize = size;\n                    for (var i = 0; i < files.length; i++) {\n                        files[i].setFontSize(size);\n                    }\n                    terminal.setFontSize(size);\n                };\n                this.getFontSize = function() {\n                    return options.fontSize;\n                };\n                this.addFile = function(file, replace, ok, showError) {\n                    if ((typeof file.name != 'string') || !VPLUtil.validPath(file.name)) {\n                        showError(str('incorrect_file_name') + '\\n(' + file.name + ')');\n                        return false;\n                    }\n                    if (replace !== true) {\n                        replace = false;\n                    }\n                    var pos = this.fileNameExists(file.name);\n                    if (pos != -1) {\n                        if (replace && !files[pos].isReadOnly()) {\n                            files[pos].setContent(file.contents);\n                            self.setModified();\n                            ok();\n                            VPLUtil.delay('updateFileList', self.updateFileList);\n                            return file;\n                        } else {\n                            showError(str('filenotadded', file.name));\n                            return false;\n                        }\n                    }\n                    if (fileNameIncluded(file.name) || twoBlockly('', file.name)) {\n                        showError(str('filenotadded', file.name));\n                        return false;\n                    }\n                    if (files.length >= maxNumberOfFiles) {\n                        showError(str('maxfilesexceeded') + '\\n(' + maxNumberOfFiles + ')');\n                        return false;\n                    }\n                    var fid = VPLUtil.getUniqueId();\n                    var newfile = new VPLFile(fid, file.name, file.contents, this, vplIdeInstance);\n                    if (file.encoding == 1) {\n                        newfile.extendToBinary();\n                    } else {\n                        if (VPLUtil.isBlockly(file.name)) {\n                            newfile.extendToBlockly();\n                        } else {\n                            newfile.extendToCodeEditor();\n                        }\n                    }\n                    newfile.setFileName(file.name);\n                    files.push(newfile);\n                    self.setModified();\n                    if (files.length > 5) {\n                        self.fileListVisible(true);\n                    }\n                    ok();\n                    return newfile;\n                };\n                this.renameFile = function(oldname, newname, showError) {\n                    var pos = this.fileNameExists(oldname);\n                    try {\n                        if (pos == -1) {\n                            throw new Error(\"Internal error: File name not found\");\n                        }\n                        if (files[pos].getId() < this.minNumberOfFiles) {\n                            throw new Error(\"Internal error: Renaming requested filename\");\n                        }\n                        if (files[pos].getFileName() == newname) {\n                            return true; // Equals name file.\n                        }\n                        if (!VPLUtil.validPath(newname) ||\n                               fileNameIncluded(newname) ||\n                               twoBlockly(oldname, newname)) {\n                            throw str('incorrect_file_name');\n                        }\n                        if (VPLUtil.isBinary(oldname) && VPLUtil.fileExtension(oldname) != VPLUtil.fileExtension(newname)) {\n                            throw str('incorrect_file_name');\n                        }\n                        if (VPLUtil.isBlockly(oldname) != VPLUtil.isBlockly(newname)) {\n                            if (files[pos].getContent() > '') {\n                                showMessage(str('delete_file_fq', oldname), {\n                                    ok: function() {\n                                        var file = {\n                                            name: newname,\n                                            contents: '',\n                                            encoding: 0\n                                        };\n                                        fileManager.deleteFile(oldname, showError);\n                                        var fileResult = fileManager.addFile(file, false, updateMenu, showErrorMessage);\n                                        if (fileResult) {\n                                            fileManager.gotoFileName(newname);\n                                        }\n                                    }\n                                });\n                            } else {\n                                var file = {\n                                    name: newname,\n                                    contents: '',\n                                    encoding: 0\n                                };\n                                fileManager.deleteFile(oldname, showError);\n                                var fileResult = fileManager.addFile(file, false, updateMenu, showError);\n                                if (fileResult) {\n                                    fileManager.gotoFileName(newname);\n                                }\n                            }\n                            return true;\n                        }\n                        files[pos].setFileName(newname);\n                    } catch (e) {\n                        showError(str('filenotrenamed', oldname) + '\\n' + e);\n                        return false;\n                    }\n                    self.setModified();\n                    adjustTabsTitles(false);\n                    VPLUtil.delay('updateFileList', self.updateFileList);\n                    return true;\n                };\n                this.directoryExists = function(dirName) {\n                    var checkName = dirName.toLowerCase() + '/';\n                    for (var i = 0; i < files.length; i++) {\n                        if (files[i].getFileName().toLowerCase().startsWith(checkName)) {\n                            return true;\n                        }\n                    }\n                    return false;\n                };\n                this.renameDirectory = function(oldName, newName, showError) {\n                    if (oldName == newName) {\n                        return false;\n                    }\n                    try {\n                        if (!this.directoryExists(oldName)) {\n                            throw new Error(\"Trying to rename a directory that doesn't exist: \" + oldName);\n                        }\n                        if (!VPLUtil.validPath(newName + '/file.txt')) {\n                            throw str('incorrect_directory_name');\n                        }\n                        // Prepare new names\n                        var oldNameLength = oldName.length + 1;\n                        var checkDirName = oldName.toLowerCase() + '/';\n                        var newFileNames = [];\n                        var i;\n                        for (i = 0; i < files.length; i++) {\n                            var fileName = files[i].getFileName();\n                            if (fileName.toLowerCase().startsWith(checkDirName)) {\n                                if (files[i].getId() < this.minNumberOfFiles) { // Renaming required filename\n                                    throw str('incorrect_file_name');\n                                }\n                                newFileNames[i] = newName + '/' + fileName.substr(oldNameLength);\n                            }\n                        }\n                        if (this.directoryExists(newName)) { // Checks if the merge is possible (no repeated names)\n                            var oldNames = [];\n                            for (i = 0; i < files.length; i++) {\n                                oldNames[files[i].getFileName().toLowerCase()] = true;\n                            }\n                            for (i = 0; i < files.length; i++) {\n                                if (newFileNames[i] && oldNames[newFileNames[i].toLowerCase()]) {\n                                    throw str('incorrect_file_name');\n                                }\n                            }\n                        }\n                        // Set the new file names\n                        for (i = 0; i < newFileNames.length; i++) {\n                            if (newFileNames[i]) {\n                                files[i].setFileName(newFileNames[i]);\n                            }\n                        }\n                    } catch (e) {\n                        showError(str('directory_not_renamed', oldName) + '\\n' + e);\n                        return false;\n                    }\n                    self.setModified();\n                    adjustTabsTitles(false);\n                    VPLUtil.delay('updateFileList', self.updateFileList);\n                    return true;\n                };\n                this.deleteFile = function(name, showError) {\n                    var pos = this.fileNameExists(name);\n                    if (pos == -1) {\n                        showError(str('filenotdeleted', name));\n                        return false;\n                    }\n                    if (files[pos].getId() < minNumberOfFiles) {\n                        showError(str('filenotdeleted', name));\n                        return false;\n                    }\n                    this.setModified();\n                    this.closeFile(files[pos]);\n                    files.splice(pos, 1);\n                    if (openFiles.length == 0) {\n                        VPLUI.hideIDEStatus();\n                    }\n                    VPLUtil.delay('updateFileList', self.updateFileList);\n                    return true;\n                };\n                this.currentFile = function() {\n                    var id = tabs.tabs('option', 'active');\n                    if (id in openFiles) {\n                        var file = openFiles[id];\n                        if (arguments.length === 0) {\n                            return file;\n                        }\n                        var action = arguments[0];\n                        if (typeof file[action] === 'function') {\n                            var fun = file[action];\n                            var args = Array.prototype.slice(arguments);\n                            args.shift();\n                            return fun.apply(file, args);\n                        }\n                    }\n                    return false;\n                };\n                this.getCurrentFileName = function() {\n                    var currentFileName = '';\n                    var currentFile = fileManager.currentFile();\n                    if (currentFile) {\n                        currentFileName = currentFile.name;\n                    }\n                    return currentFileName;\n                };\n                this.currentPos = function() {\n                    return tabs.tabs('option', 'active');\n                };\n                this.getFileTab = function(id) {\n                    for (var i = 0; i < openFiles.length; i++) {\n                        if (openFiles[i].getId() == id) {\n                            return i;\n                        }\n                    }\n                    return -1;\n                };\n                this.getFilePosById = function(id) {\n                    for (var i = 0; i < files.length; i++) {\n                        if (files[i].getId() == id) {\n                            return i;\n                        }\n                    }\n                    return -1;\n                };\n                this.gotoFile = function(pos, l) {\n                    var file = files[pos];\n                    self.open(file);\n                    tabs.tabs('option', 'active', self.getFileTab(file.getId()));\n                    if (l !== 'c') {\n                        file.gotoLine(parseInt(l, 10));\n                    }\n                    file.focus();\n                };\n                this.gotoFileLink = function(a) {\n                    var tag = $(a);\n                    var fname = tag.data('file');\n                    var fpos = -1;\n                    if (fname > '') {\n                        fpos = this.fileNameExists(fname);\n                    } else {\n                        fpos = self.getFilePosById(tag.data('fileid'));\n                    }\n                    if (fpos >= 0) {\n                        var line = tag.data('line');\n                        if (typeof line == 'undefined') {\n                            line = 'c';\n                        }\n                        self.gotoFile(fpos, line);\n                        return true;\n                    }\n                    return false;\n                };\n                this.gotoFileName = function(fname, line) {\n                    var fpos = this.fileNameExists(fname);\n                    if (fpos >= 0) {\n                        if (typeof line == 'undefined') {\n                            line = 'c';\n                        }\n                        self.gotoFile(fpos, line);\n                        return true;\n                    }\n                    return false;\n                };\n                this.getFilesToSave = function() {\n                    var ret = [];\n                    for (var i = 0; i < files.length; i++) {\n                        var file = {};\n                        file.name = files[i].getFileName();\n                        file.contents = files[i].getContent();\n                        file.encoding = files[i].isBinary() ? 1 : 0;\n                        ret.push(file);\n                    }\n                    return ret;\n                };\n                this.resetModified = function() {\n                    modified = false;\n                    for (var i = 0; i < files.length; i++) {\n                        files[i].resetModified();\n                    }\n                    VPLUtil.delay('updateMenu', updateMenu);\n                    VPLUtil.delay('updateFileList', self.updateFileList);\n                };\n                this.setModified = function() {\n                    modified = true;\n                    VPLUtil.delay('updateFileList', self.updateFileList);\n                    VPLUtil.delay('updateMenu', updateMenu);\n                };\n                this.isModified = function() {\n                    return modified;\n                };\n                this.length = function() {\n                    return files.length;\n                };\n                this.clearAnnotations = function() {\n                    for (var i = 0; i < files.length; i++) {\n                        files[i].clearAnnotations();\n                    }\n                };\n                this.getFile = function(i) {\n                    return files[i];\n                };\n                this.getFiles = function() {\n                    return files;\n                };\n                this.getDirectoryStructure = function() {\n                    var structure = {\n                        isDir: true,\n                        content: {},\n                        path: '',\n                    };\n                    /**\n                     * Adds a new file the structure of directories\n                     * @param {int} i Index of file to add in the file array\n                     */\n                    function addFilePath(i) {\n                        var file = files[i];\n                        var fileName = file.getFileName();\n                        var path = fileName.split(\"/\");\n                        var curdir = structure;\n                        var pathdir = '';\n                        for (var p = 0; p < path.length; p++) {\n                            var part = path[p];\n                            if (p == path.length - 1) { // File.\n                                curdir.content[part] = {\n                                    isDir: false,\n                                    content: file,\n                                    pos: i,\n                                };\n                            } else {\n                                pathdir += part;\n                                if (!curdir.content[part]) { // New dir.\n                                    curdir.content[part] = {\n                                        isDir: true,\n                                        content: {},\n                                        path: pathdir,\n                                    };\n                                }\n                                // Descend Dir.\n                                pathdir += '/';\n                                curdir = curdir.content[part];\n                            }\n                        }\n                    }\n                    for (var i in files) {\n                        if (files.hasOwnProperty(i)) {\n                            addFilePath(i);\n                        }\n                    }\n                    return structure;\n                };\n                this.generateFileList = function() {\n                    if (!self.isFileListVisible()) {\n                        return;\n                    }\n                    var dirIndent = '<span class=\"vpl_ide_dirindent\"></span>';\n                    /**\n                     * Generates an array of string with the HTML code to represent the list of IDE files\n                     * @param {Object} dir Current directory\n                     * @param {int} indent Html code to indent subdirectories\n                     * @param {Array} lines Output. Each line contains the HTML to represent an IDE file\n                     */\n                    function lister(dir, indent, lines) {\n                        var name, fd, sname, attrs, dirline, file, path, line;\n                        for (name in dir.content) {\n                            if (dir.content.hasOwnProperty(name)) {\n                                fd = dir.content[name];\n                                if (fd.isDir) {\n                                    var dirpath = VPLUtil.sanitizeText(fd.path);\n                                    attrs = 'href=\"#\" data-dirname=\"' + dirpath + '\" ';\n                                    sname = VPLUtil.sanitizeText(name);\n                                    dirline = indent;\n                                    dirline += VPLUI.iconFolder() + '<a ' + attrs + '>' + sname + '</a>';\n                                    lines.push(dirline);\n                                    lister(fd, indent + dirIndent, lines);\n                                } else {\n                                    file = fd.content;\n                                    sname = VPLUtil.sanitizeText(name);\n                                    path = VPLUtil.sanitizeText(file.getFileName());\n                                    if (file.isOpen()) {\n                                        sname = '<b>' + sname + '</b>';\n                                    }\n                                    attrs = 'href=\"#\" data-fileid=\"' + file.getId() + '\" title=\"' + path + '\"';\n                                    line = '<a ' + attrs + '>' + sname + '</a>';\n                                    if (file.isModified()) {\n                                        line = VPLUI.iconModified() + line;\n                                    }\n                                    if (file.isReadOnly()) {\n                                        line = line + VPLUI.iconReadOnly();\n                                    } else if (file.getId() < minNumberOfFiles) {\n                                        line = line + VPLUI.iconRequired();\n                                    }\n                                    lines.push(indent + line);\n                                }\n                            }\n                        }\n                    }\n\n                    var structure = self.getDirectoryStructure();\n                    var lines = [];\n                    var html = '';\n                    lister(structure, '', lines);\n                    for (var i = 0; i < lines.length; i++) {\n                        html += lines[i] + '<br>';\n                    }\n                    fileListContent.html('<div>' + html + '</div>');\n                };\n                tabsUl.on('click', 'span.vpl_ide_closeicon', function() {\n                    fileManager.closeFile(fileManager.currentFile());\n                });\n                tabsUl.on('dblclick', 'span.vpl_ide_closeicon', menuButtons.getAction('delete'));\n                tabsUl.on('dblclick', 'a', menuButtons.getAction('rename'));\n                fileListContent.on('dblclick', 'a[data-fileid]', menuButtons.getAction('rename'));\n                fileListContent.on('dblclick', 'a[data-dirname]', renameDiretoryAction);\n            }\n            this.updateEvaluationNumber = function(res) {\n                if (typeof res.nevaluations != 'undefined') {\n                    var text = res.nevaluations;\n                    if (typeof res.reductionbyevaluation != 'undefined'\n                         && res.reductionbyevaluation > ''\n                         && res.reductionbyevaluation != 0) {\n                        if (res.freeevaluations != 0) {\n                            text = text + '/' + res.freeevaluations;\n                        }\n                        text = text + ' -' + res.reductionbyevaluation;\n                    }\n                    menuButtons.setExtracontent('evaluate', text);\n                }\n            };\n            this.lastResult = null;\n            this.getTerminal = function() {\n                return terminal;\n            };\n            this.setResultGrade = function(content, raw) {\n                var name = 'grade';\n                var titleclass = 'vpl_ide_accordion_t_' + name;\n                var contentclass = 'vpl_ide_accordion_c_' + name;\n                if (result.find('.' + contentclass).length == 0) {\n                    result.append('<div class=\"' + titleclass + '\"></div>');\n                    result.append('<div class=\"' + contentclass + '\"></div>');\n                }\n                if (typeof raw == 'undefined') {\n                    return result.find('h4.' + titleclass).length > 0;\n                }\n                var titleTag = result.find('.' + titleclass);\n                if (content > '') {\n                    titleTag.replaceWith('<h4 class=\"' + titleclass + '\">' + content + '</h4>');\n                    return true;\n                } else {\n                    titleTag.replaceWith('<div class=\"' + titleclass + '\"></div>');\n                    return false;\n                }\n            };\n            this.setResultTab = function(name, content, raw) {\n                var titleclass = 'vpl_ide_accordion_t_' + name;\n                var contentclass = 'vpl_ide_accordion_c_' + name;\n                if (result.find('.' + contentclass).length == 0) {\n                    result.append('<div class=\"' + titleclass + '\"></div>');\n                    result.append('<div class=\"' + contentclass + '\"></div>');\n                }\n                if (typeof raw == 'undefined') {\n                    return result.find('h4.' + titleclass).length > 0;\n                }\n                var titleTag = result.find('.' + titleclass);\n                var contentTag = result.find('.' + contentclass);\n                var HTMLcontent = $('<div>' + content + '</div>');\n                HTMLcontent.find('h4').replaceWith(function() {\n                    return $(\"<h5>\").append($(this).contents());\n                });\n                if (contentTag.html() == HTMLcontent.html()) {\n                    return content > '';\n                }\n                if (content > '') {\n                    titleTag.replaceWith('<h4 class=\"' + titleclass + '\">' + str(name) + '</h4>');\n                    contentTag.replaceWith('<div class=\"ui-widget ' + contentclass + '\">' + HTMLcontent.html() + '</div>');\n                    return true;\n                } else {\n                    titleTag.replaceWith('<div class=\"' + titleclass + '\"></div>');\n                    contentTag.replaceWith('<div class=\"' + contentclass + '\"></div>');\n                    return false;\n                }\n            };\n            this.applyMathJax = function() {\n                if (typeof window.MathJax == 'object') { // MathJax is loaded\n                    try {\n                        let math = result.find(\".vpl_ide_accordion_c_description\")[0];\n                        if (math) {\n                            if (window.MathJax.Hub && window.MathJax.Hub.Queue) {\n                                window.MathJax.Hub.Queue([\"Typeset\", window.MathJax.Hub, math]);\n                            } else if (window.MathJax.startup && window.MathJax.startup.promise) {\n                                window.MathJax.startup.promise = window.MathJax.startup.promise\n                                .then(() => window.MathJax.typesetPromise([math]))\n                                .catch(e => {\n                                    VPLUtil.log(\"MathJax error\" + e);\n                                });\n                            }\n                        }\n                    } catch (e) {\n                        VPLUtil.log(\"MathJax error\" + e);\n                    }\n                }\n            };\n            this.setResult = function(res, go) {\n                self.updateEvaluationNumber(res);\n                var files = fileManager.getFiles();\n                var fileNames = [];\n                var i;\n                for (i = 0; i < files.length; i++) {\n                    fileNames[i] = files[i].getFileName();\n                    files[i].clearAnnotations();\n                }\n                var show = false;\n                var hasContent;\n                var grade = VPLUtil.sanitizeText(res.grade);\n                var gradeShow;\n                var formated;\n                gradeShow = self.setResultGrade(grade, res.grade);\n                show = show || gradeShow;\n                hasContent = self.setResultTab('variables', res.variables, res.variables);\n                show = show || hasContent;\n                formated = VPLUtil.processResult(res.compilation, fileNames, files, true, false);\n                hasContent = self.setResultTab('compilation', formated, res.compilation);\n                show = show || hasContent;\n                formated = VPLUtil.processResult(res.evaluation, fileNames, files, false, false);\n                hasContent = self.setResultTab('comments', formated, res.evaluation);\n                show = show || hasContent;\n                formated = VPLUtil.sanitizeText(res.execution);\n                hasContent = self.setResultTab('execution', formated, res.execution);\n                show = show || hasContent;\n                hasContent = self.setResultTab('description', window.VPLDescription, window.VPLDescription);\n                if (hasContent) {\n                    self.applyMathJax();\n                }\n                show = show || hasContent;\n                if (show) {\n                    resultContainer.show();\n                    resultContainer.vplVisible = true;\n                    result.accordion(\"refresh\");\n                    result.accordion('option', 'active', gradeShow ? 1 : 0);\n                    for (i = 0; i < files.length; i++) {\n                        var anot = files[i].getAnnotations();\n                        for (var j = 0; j < anot.length; j++) {\n                            if (go || anot[j].type == 'error') {\n                                fileManager.gotoFile(i, anot[j].row + 1);\n                                break;\n                            }\n                        }\n                    }\n                    $('#vpl_ide_shrightpanel').show();\n                } else {\n                    resultContainer.hide();\n                    resultContainer.vplVisible = false;\n                    $('#vpl_ide_shrightpanel').hide();\n                }\n                VPLUtil.delay('autoResizeTab', autoResizeTab);\n                VPLUtil.delay('fixAccordion', function() {\n                    result.accordion('option', 'active', gradeShow ? 1 : 0);\n                });\n            };\n\n            result.accordion({\n                heightStyle: 'fill',\n                header: 'h4',\n                animate: false,\n                beforeActivate: avoidSelectGrade,\n            });\n            resultContainer.width(2 * resultContainer.vplMinWidth);\n            result.on('click', 'a', function(event) {\n                if (fileManager.gotoFileLink(event.currentTarget)) {\n                    event.preventDefault();\n                }\n            });\n            resultContainer.vplVisible = false;\n            resultContainer.hide();\n\n            fileListContainer.addClass('ui-tabs ui-widget ui-widget-content ui-corner-all');\n            fileList.text(str('filelist'));\n            fileList.html(VPLUI.iconFolder() + fileList.html());\n            fileList.addClass(\"ui-widget-header ui-button-text-only ui-corner-all\");\n            fileListContent.addClass(\"ui-widget ui-corner-all\");\n            fileListContainer.width(2 * fileListContainer.vplMinWidth);\n            fileListContainer.on('click', 'a', function(event) {\n                event.preventDefault();\n                fileManager.gotoFileLink(event.currentTarget);\n            });\n            fileListContainer.vplVisible = false;\n            fileListContainer.hide();\n            var tabsAir = false;\n            /**\n             * Returns separation space\n             * @returns {int} size in pixels\n             */\n            function getTabsAir() {\n                if (tabsAir === false) {\n                    tabsAir = (tabs.outerWidth(true) - tabs.width()) / 2;\n                }\n                return tabsAir;\n            }\n            /**\n             * Resize tab width\n             * @param {Event} e Unused\n             * @param {Object} ui UI object\n             */\n            function resizeTabWidth(e, ui) {\n                var diffLeft = ui.position.left - ui.originalPosition.left;\n                var maxWidth;\n                if (diffLeft !== 0) {\n                    maxWidth = tabs.width() + fileListContainer.width() - fileListContainer.vplMinWidth;\n                    tabs.resizable('option', 'maxWidth', maxWidth);\n                    fileListContainer.width(fileListContainer.vplOriginalWidth + diffLeft);\n                } else {\n                    maxWidth = tabs.width() + resultContainer.width() - resultContainer.vplMinWidth;\n                    tabs.resizable('option', 'maxWidth', maxWidth);\n                    var diffWidth = ui.size.width - ui.originalSize.width;\n                    resultContainer.width(resultContainer.vplOriginalWidth - diffWidth);\n                }\n                fileManager.currentFile('adjustSize');\n            }\n            var resizableOptions = {\n                containment: 'parent',\n                resize: resizeTabWidth,\n                start: function() {\n                    $(window).off('resize', autoResizeTab);\n                    tabs.resizable('option', 'minWidth', 100);\n                    if (resultContainer.vplVisible) {\n                        resultContainer.vplOriginalWidth = resultContainer.width();\n                    }\n                    if (fileListContainer.vplVisible) {\n                        fileListContainer.vplOriginalWidth = fileListContainer.width();\n                    }\n                },\n                stop: function(e, ui) {\n                    resizeTabWidth(e, ui);\n                    tabs.resizable('option', 'maxWidth', 100000);\n                    tabs.resizable('option', 'minWidth', 0);\n                    autoResizeTab();\n                    $(window).on('resize', autoResizeTab);\n                },\n                handles: \"\"\n            };\n            tabs.resizable(resizableOptions);\n             /**\n              * Updates handles for internal IDE resize\n              */\n            function updateTabsHandles() {\n                var handles = ['e', 'w', 'e', 'e, w'];\n                var index = 0;\n                index += fileListContainer.vplVisible ? 1 : 0;\n                index += resultContainer.vplVisible ? 2 : 0;\n                tabs.resizable('destroy');\n                resizableOptions.handles = handles[index];\n                resizableOptions.disable = index === 0;\n                tabs.resizable(resizableOptions);\n            }\n            /**\n             * Resize the IDE height\n             */\n            function resizeHeight() {\n                var newHeight = $(window).outerHeight();\n                newHeight -= menu.offset().top + menu.height() + (fullScreen ? getTabsAir() : 20);\n                if (newHeight < 250) {\n                    newHeight = 250;\n                }\n                tr.height(newHeight);\n                var panelHeight = newHeight - 3 * getTabsAir();\n                tabs.height(panelHeight);\n                if (resultContainer.vplVisible) {\n                    resultContainer.height(panelHeight + getTabsAir());\n                    result.accordion('refresh');\n                }\n                if (fileListContainer.vplVisible) {\n                    fileListContent.height(panelHeight - (fileList.outerHeight() + getTabsAir()));\n                    fileListContainer.height(panelHeight);\n                }\n            }\n            adjustTabsTitles = function(center) {\n                var newWidth = tabs.width();\n                var tabsUlWidth = 0;\n                tabsUl.width(100000);\n                var last = tabsUl.children('li:visible').last();\n                if (last.length) {\n                    var parentScrollLeft = tabsUl.parent().scrollLeft();\n                    tabsUlWidth = parentScrollLeft + last.position().left + last.width() + tabsAir;\n                    tabsUl.width(tabsUlWidth);\n                    var file = fileManager.currentFile();\n                    if (file && center) {\n                        var fileTab = $(file.getTabNameId());\n                        var scroll = parentScrollLeft + fileTab.position().left;\n                        scroll -= (newWidth - fileTab.outerWidth()) / 2;\n                        if (scroll < 0) {\n                            scroll = 0;\n                        }\n                        tabsUl.parent().finish().animate({\n                            scrollLeft: scroll\n                        }, 'slow');\n                    }\n                }\n                if (tabsUlWidth < newWidth) {\n                    tabsUl.width('');\n                }\n            };\n            autoResizeTab = function() {\n                var oldWidth = tabs.width();\n                var newWidth = menu.width();\n                var planb = false;\n                updateTabsHandles();\n                tr.width(menu.outerWidth());\n                if (fileListContainer.vplVisible) {\n                    var left = fileListContainer.outerWidth() + tabsAir;\n                    oldWidth += left;\n                    if (left >= 100) {\n                        newWidth -= left;\n                        tabs.css('left', left);\n                    } else {\n                        planb = true;\n                    }\n                } else {\n                    tabs.css('left', 0);\n                }\n                if (resultContainer.vplVisible) {\n                    var right = resultContainer.outerWidth() + tabsAir;\n                    oldWidth += right;\n                    newWidth -= right;\n                    if (newWidth < 100) {\n                        planb = true;\n                    }\n                }\n                if (planb) {\n                    var rel = menu.width() / oldWidth;\n                    var wfl = 0;\n                    if (fileListContainer.vplVisible) {\n                        wfl = fileListContainer.width() * rel;\n                        fileListContainer.width(wfl - tabsAir);\n                        wfl += tabsAir;\n                        tabs.css('left', wfl);\n                    }\n                    tabs.width(tabs.width() * rel);\n                    if (resultContainer.vplVisible) {\n                        resultContainer.width(menu.width() - (wfl + tabs.width() + tabsAir));\n                    }\n                } else {\n                    tabs.width(newWidth);\n                }\n                adjustTabsTitles(true);\n                resizeHeight();\n                fileManager.currentFile('adjustSize');\n            };\n            /**\n             * Transfer focus to current file\n             */\n            function focusCurrentFile() {\n                fileManager.currentFile('focus');\n            }\n            var dialogbaseOptions = $.extend({}, {\n                close: focusCurrentFile\n            }, VPLUI.dialogbaseOptions);\n            /**\n             * Shows a dialog with a message.\n             * @param {string} message\n             * @param {Object} options icon, title, actions handler (ok, yes, no, close)\n             * @returns {JQuery} JQueryUI Dialog object already open\n             */\n            function showMessage(message, options) {\n                return VPLUI.showMessage(message, $.extend({}, dialogbaseOptions, options));\n            }\n            showErrorMessage = function(message) {\n                return VPLUI.showErrorMessage(message, {\n                    close: focusCurrentFile\n                });\n            };\n\n            var dialogNew = $('#vpl_ide_dialog_new');\n            /**\n             * The event handler for the new file action\n             * @param {Object} event\n             * @return {boolean}\n             */\n            function newFileHandler(event) {\n                if (!(event.type == 'click' || ((event.type == 'keypress') && event.keyCode == 13))) {\n                    return true;\n                }\n                dialogNew.dialog('close');\n                var file = {\n                    name: $('#vpl_ide_input_newfilename').val(),\n                    contents: '',\n                    encoding: 0\n                };\n                var newfile = fileManager.addFile(file, false, updateMenu, showErrorMessage);\n                if (newfile) {\n                    fileManager.open(newfile);\n                    tabs.tabs('option', 'active', fileManager.getTabPos(newfile.getId()));\n                    newfile.focus();\n                    return true;\n                }\n                return false;\n            }\n\n            var dialogButtons = {};\n            dialogButtons[str('ok')] = newFileHandler;\n            dialogButtons[str('cancel')] = function() {\n                $(this).dialog('close');\n            };\n            dialogNew.find('input').on('keypress', newFileHandler);\n            dialogNew.dialog($.extend({}, dialogbaseOptions, {\n                title: str('create_new_file'),\n                buttons: dialogButtons\n            }));\n            VPLUI.setDialogTitleIcon(dialogNew, 'new');\n\n            var dialogRename = $('#vpl_ide_dialog_rename');\n            /**\n             * The event handler for the rename current file action\n             * @param {Object} event\n             */\n            function renameHandler(event) {\n                if (!(event.type == 'click' || ((event.type == 'keypress') && event.keyCode == 13))) {\n                    return;\n                }\n                dialogRename.dialog('close');\n                fileManager.renameFile(fileManager.currentFile('getFileName'),\n                        $('#vpl_ide_input_renamefilename').val(), showErrorMessage);\n                event.preventDefault();\n            }\n            dialogRename.find('input').on('keypress', renameHandler);\n            dialogButtons[str('ok')] = renameHandler;\n            dialogRename.dialog($.extend({}, dialogbaseOptions, {\n                open: function() {\n                    $('#vpl_ide_input_renamefilename').val(fileManager.currentFile('getFileName'));\n                },\n                title: str('rename_file'),\n                buttons: dialogButtons\n            }));\n            VPLUI.setDialogTitleIcon(dialogRename, 'rename');\n\n            var dialogRenameDirectory = $('#vpl_ide_dialog_renamedir');\n            /**\n             * The event handler for rename a directory\n             * @param {Object} event\n             */\n            function renameDirectoryHandler(event) {\n                if (!(event.type == 'click' || ((event.type == 'keypress') && event.keyCode == 13))) {\n                    return;\n                }\n                dialogRenameDirectory.dialog('close');\n                fileManager.renameDirectory($('#vpl_ide_input_olddirectoryname').val(),\n                        $('#vpl_ide_input_renamedirectory').val(), showErrorMessage);\n                event.preventDefault();\n            }\n            dialogRenameDirectory.find('input').on('keypress', renameDirectoryHandler);\n            dialogButtons[str('ok')] = renameDirectoryHandler;\n            dialogRenameDirectory.dialog($.extend({}, dialogbaseOptions, {\n                title: str('rename_directory'),\n                buttons: dialogButtons\n            }));\n            VPLUI.setDialogTitleIcon(dialogRenameDirectory, 'filelist');\n            renameDiretoryAction = function(event) {\n                if (event.target.hasAttribute('data-dirname')) {\n                    var dirname = event.target.getAttribute('data-dirname');\n                    $('#vpl_ide_input_olddirectoryname').val(dirname);\n                    $('#vpl_ide_input_renamedirectory').val(dirname);\n                    dialogRenameDirectory.dialog('open');\n                }\n            };\n            var dialogComments = $('#vpl_ide_dialog_comments');\n            var oldStudentComments = '';\n            dialogButtons[str('ok')] = function() {\n                if (oldStudentComments != $('#vpl_ide_input_comments').val()) {\n                    fileManager.setModified();\n                }\n                $(this).dialog('close');\n            };\n            dialogComments.dialog($.extend({}, dialogbaseOptions, {\n                open: function() {\n                    oldStudentComments = $('#vpl_ide_input_comments').val();\n                },\n                title: str('comments'),\n                width: '40em',\n                buttons: dialogButtons\n            }));\n            VPLUI.setDialogTitleIcon(dialogComments, 'comments');\n\n            $('#vpl_ide_input_comments').width('30em');\n            var aboutDialog = $('#vpl_ide_dialog_about');\n            var OKButtons = {};\n            OKButtons[str('ok')] = function() {\n                $(this).dialog('close');\n            };\n            var shortcutDialog = $('#vpl_ide_dialog_shortcuts');\n            shortcutDialog.dialog($.extend({}, dialogbaseOptions, {\n                open: function() {\n                    var html = menuButtons.getShortcuts(fileManager.currentFile('getEditor'));\n                    $('#vpl_ide_dialog_shortcuts').html(html);\n                },\n                title: str('shortcuts'),\n                width: 400,\n                height: 300,\n                buttons: OKButtons\n            }));\n            shortcutDialog.dialog('option', 'height', 300);\n            VPLUI.setDialogTitleIcon(shortcutDialog, 'shortcuts');\n\n            OKButtons[str('shortcuts')] = function() {\n                $(this).dialog('close');\n                shortcutDialog.dialog('open');\n            };\n            aboutDialog.dialog($.extend({}, dialogbaseOptions, {\n                open: function() {\n                    var html = menuButtons.getShortcuts(fileManager.currentFile('getEditor'));\n                    aboutDialog.next().find(\"button\").filter(\n                        function() {\n                            return $(this).text() == str('shortcuts');\n                        }\n                  ).button(html != '' ? 'enable' : 'disable');\n                },\n                title: str('about'),\n                width: 400,\n                height: 300,\n                buttons: OKButtons\n            }));\n            aboutDialog.dialog('option', 'height', 300);\n            VPLUI.setDialogTitleIcon(aboutDialog, 'about');\n\n            var dialogSort = $('#vpl_ide_dialog_sort');\n            var dialogSortButtons = {};\n            dialogSortButtons[str('ok')] = function() {\n                var files = fileManager.getFiles();\n                var regNoNumber = /[^\\d]*/;\n                var sorted = [];\n                var i = 0;\n                var newOrder = $('#vpl_sort_list li');\n                if (newOrder.length != files.length) {\n                    return;\n                }\n                newOrder.each(function() {\n                    var orig = parseInt(this.id.replace(regNoNumber, ''));\n                    sorted.push(files[orig]);\n                });\n                for (i = 0; i < newOrder.length; i++) {\n                    files[i] = sorted[i];\n                }\n                fileManager.setModified();\n                $(this).dialog('close');\n            };\n            dialogSortButtons[str('cancel')] = function() {\n                $(this).dialog('close');\n            };\n            dialogSort.dialog($.extend({}, dialogbaseOptions, {\n                title: str('sort'),\n                buttons: dialogSortButtons,\n                open: function() {\n                    var list = $('#vpl_sort_list');\n                    list.html('');\n                    var files = fileManager.getFiles();\n                    for (var i = 0; i < files.length; i++) {\n                        var file = $('<li id=\"vpl_fsort_' + i + '\"class=\"ui-widget-content\"></li>');\n                        if (files[i].getId() < minNumberOfFiles) {\n                            file.addClass('ui-state-disabled');\n                        }\n                        file.text((i + 1) + '-' + files[i].getFileName());\n                        list.append(file);\n                    }\n                    list.sortable({\n                        items: \"li:not(.ui-state-disabled)\",\n                        placeholder: \"ui-state-highlight\",\n                        start: function(event, ui) {\n                            ui.item.addClass('ui-state-highlight');\n                        },\n                        stop: function(event, ui) {\n                            ui.item.removeClass('ui-state-highlight');\n                        },\n                    });\n                    list.disableSelection();\n                },\n                maxHeight: 400\n            }));\n            VPLUI.setDialogTitleIcon(dialogSort, 'sort');\n\n            var dialogMultidelete = $('#vpl_ide_dialog_multidelete');\n            var dialogMultideleteButtons = {};\n            dialogMultideleteButtons[str('selectall')] = function() {\n                $(this).find('input').prop(\"checked\", true);\n            };\n            dialogMultideleteButtons[str('deselectall')] = function() {\n                $(this).find('input').prop(\"checked\", false);\n            };\n            dialogMultideleteButtons[str('deleteselected')] = function() {\n                var files = fileManager.getFiles();\n                var toDeleteList = [];\n                var labelList = $('#vpl_multidelete_list label');\n                labelList.each(function() {\n                    var label = $(this);\n                    if (label.find('input').prop('checked')) {\n                        var id = label.data('fileid');\n                        toDeleteList.push(files[id].getFileName());\n                    }\n                });\n                for (var i = 0; i < toDeleteList.length; i++) {\n                    fileManager.deleteFile(toDeleteList[i], showErrorMessage);\n                }\n                VPLUtil.delay('updateMenu', updateMenu);\n                VPLUtil.delay('updateFileList', fileManager.updateFileList);\n                $(this).dialog('close');\n            };\n            dialogMultideleteButtons[str('cancel')] = function() {\n                $(this).dialog('close');\n            };\n            dialogMultidelete.dialog($.extend({}, dialogbaseOptions, {\n                title: str('multidelete'),\n                buttons: dialogMultideleteButtons,\n                open: function() {\n                    var list = $('#vpl_multidelete_list');\n                    list.html('');\n                    var files = fileManager.getFiles();\n                    for (var i = minNumberOfFiles; i < files.length; i++) {\n                        var name = VPLUtil.sanitizeText(files[i].getFileName());\n                        var file = $('<label><input type=\"checkbox\"> ' + name + '</label>');\n                        file.data('fileid', i);\n                        list.append(file);\n                        list.append('<br>');\n                    }\n                    list.find('label').button();\n                },\n                maxHeight: 400,\n                maxWidth: 400\n            }));\n            VPLUI.setDialogTitleIcon(dialogMultidelete, 'multidelete');\n\n            var dialogFontsize = $('#vpl_ide_dialog_fontsize');\n            var fontsizeSlider = $('#vpl_ide_dialog_fontsize .vpl_fontsize_slider');\n            var dialogFontFizeButtons = {};\n            dialogFontFizeButtons[str('ok')] = function() {\n                var value = fontsizeSlider.slider(\"value\");\n                fileManager.setFontSize(value);\n                $(this).dialog('close');\n                VPLUtil.setUserPreferences({fontSize: value});\n            };\n            dialogFontFizeButtons[str('cancel')] = function() {\n                fileManager.setFontSize(fontsizeSlider.data(\"vpl_fontsize\"));\n                $(this).dialog('close');\n            };\n            dialogFontFizeButtons[str('reset')] = function() {\n                fontsizeSlider.slider('value', 12);\n            };\n            dialogFontsize.dialog($.extend({}, dialogbaseOptions, {\n                title: str('fontsize'),\n                buttons: dialogFontFizeButtons,\n                open: function() {\n                    fontsizeSlider.data(\"vpl_fontsize\", fileManager.getFontSize());\n                    fontsizeSlider.slider('value', fileManager.getFontSize());\n                },\n            }));\n            fontsizeSlider.slider({\n                min: 1,\n                max: 48,\n                change: function() {\n                    var value = fontsizeSlider.slider(\"value\");\n                    fileManager.setFontSize(value);\n                    dialogFontsize.find('.vpl_fontsize_slider_value').text(value);\n                }\n            });\n            VPLUI.setDialogTitleIcon(dialogFontsize, 'fontsize');\n\n            var dialogAceTheme = $('#vpl_ide_dialog_acetheme');\n            var acethemeSelect = $('#vpl_ide_dialog_acetheme select');\n            var dialogAceThemeButtons = {};\n            dialogAceThemeButtons[str('ok')] = function() {\n                fileManager.setTheme(acethemeSelect.val());\n                $(this).dialog('close');\n                VPLUtil.setUserPreferences({aceTheme: acethemeSelect.val()});\n            };\n            dialogAceThemeButtons[str('cancel')] = function() {\n                fileManager.setTheme(acethemeSelect.data(\"acetheme\"));\n                $(this).dialog('close');\n            };\n            dialogAceThemeButtons[str('reset')] = function() {\n                acethemeSelect.val(acethemeSelect.data(\"acetheme\"));\n                fileManager.setTheme(acethemeSelect.val());\n            };\n            dialogAceTheme.dialog($.extend({}, dialogbaseOptions, {\n                title: str('theme'),\n                buttons: dialogAceThemeButtons,\n                modal: false,\n                open: function() {\n                    acethemeSelect.data(\"acetheme\", fileManager.getTheme());\n                    acethemeSelect.val(fileManager.getTheme());\n                },\n            }));\n            acethemeSelect.on('change', function() {\n                    fileManager.setTheme(acethemeSelect.val());\n            });\n            VPLUI.setDialogTitleIcon(dialogAceTheme, 'theme');\n\n            var terminal = new VPLTerminal('vpl_dialog_terminal', 'vpl_terminal', str);\n            var VNCClient = new VPLVNCClient('vpl_dialog_vnc', str);\n            var lastConsole = terminal;\n            var fileSelect = $('#vpl_ide_input_file');\n            var fileSelectHandler = function() {\n                VPLUI.readSelectedFiles(this.files, function(file) {\n                    return fileManager.addFile(file, true, updateMenu, showErrorMessage);\n                },\n                function() {\n                    fileManager.fileListVisibleIfNeeded();\n                });\n            };\n            fileSelect.on('change', fileSelectHandler);\n            // Menu acctions.\n            menuButtons.add({\n                name: 'filelist',\n                originalAction: function() {\n                    fileManager.fileListVisible(!fileManager.isFileListVisible());\n                    VPLUtil.delay('updateMenu', updateMenu);\n                    VPLUtil.delay('autoResizeTab', autoResizeTab);\n                    VPLUtil.delay('updateFileList', fileManager.updateFileList);\n                },\n                bindKey: {\n                    win: 'Ctrl-L',\n                    mac: 'Ctrl-L'\n                }\n            });\n\n            menuButtons.add({\n                name: 'new',\n                originalAction: function() {\n                    if (fileManager.length() < maxNumberOfFiles) {\n                        dialogNew.dialog('open');\n                    }\n                },\n                bindKey: {\n                    win: 'Alt-N',\n                    mac: 'Option-N'\n                }\n            });\n            menuButtons.add({\n                name: 'rename',\n                originalAction: function() {\n                    var file = fileManager.currentFile();\n                    if (file && file.getId() >= minNumberOfFiles) {\n                        dialogRename.dialog('open');\n                    }\n                },\n                bindKey: {\n                    win: 'Ctrl-R',\n                    mac: 'Ctrl-R'\n                }\n            });\n            menuButtons.add({\n                name: 'delete',\n                originalAction: function() {\n                    var file = fileManager.currentFile();\n                    if (!file) {\n                        return;\n                    }\n                    var filename = file.getFileName();\n                    var message = str('delete_file_fq', filename);\n                    showMessage(message, {\n                        ok: function() {\n                            fileManager.deleteFile(filename, showErrorMessage);\n                        },\n                        title: str('delete_file_q'),\n                        icon: 'trash'\n                    });\n                },\n                bindKey: {\n                    win: 'Ctrl-D',\n                    mac: 'Ctrl-D'\n                }\n            });\n            menuButtons.add({\n                name: 'close',\n                originalAction: function() {\n                    var file = fileManager.currentFile();\n                    if (!file) {\n                        return;\n                    }\n                    fileManager.closeFile(file);\n                },\n                bindKey: {\n                    win: 'Alt-W',\n                    mac: 'Option-W'\n                }\n            });\n            menuButtons.add({\n                name: 'import',\n                originalAction: function() {\n                    fileSelect.val('');\n                    fileSelect.trigger('click');\n                },\n                bindKey: {\n                    win: 'Ctrl-I',\n                    mac: 'Ctrl-I'\n                }\n            });\n            menuButtons.add({\n                name: 'sort',\n                originalAction: function() {\n                    dialogSort.dialog('open');\n                },\n                bindKey: {\n                    win: 'Ctrl-O',\n                    mac: 'Ctrl-O'\n                }\n            });\n            menuButtons.add({\n                name: 'multidelete',\n                originalAction: function() {\n                    dialogMultidelete.dialog('open');\n                }\n            });\n            menuButtons.add({\n                name: 'showparentfiles',\n                originalAction: function() {\n                    openpopup(null, {\n                        url: options.showparentfilesurl,\n                        options: 'width=' + Math.max(screen.availWidth / 2, 780) +\n                                 ',height=' + screen.availHeight +\n                                 ',left=' + (screen.availWidth / 4)\n                    });\n                }\n            });\n            menuButtons.add({\n                name: 'fontsize',\n                originalAction: function() {\n                    dialogFontsize.dialog('open');\n                }\n            });\n            menuButtons.add({\n                name: 'theme',\n                originalAction: function() {\n                    dialogAceTheme.dialog('open');\n                }\n            });\n            menuButtons.add({\n                name: 'print',\n                originalAction: function() {\n                    window.print();\n                },\n                bindKey: {\n                    win: 'Alt-P',\n                    mac: 'Command-P'\n                }\n            });\n            menuButtons.add({\n                name: 'undo',\n                originalAction: function() {\n                    fileManager.currentFile('undo');\n                }\n            });\n            menuButtons.add({\n                name: 'redo',\n                originalAction: function() {\n                    fileManager.currentFile('redo');\n                }\n            });\n            menuButtons.add({\n                name: 'select_all',\n                editorName: 'selectall',\n                originalAction: function() {\n                    fileManager.currentFile('selectAll');\n                }\n            });\n            menuButtons.add({\n                name: 'find',\n                originalAction: function() {\n                    fileManager.currentFile('find');\n                }\n            });\n            menuButtons.add({\n                name: 'find_replace',\n                editorName: 'replace',\n                originalAction: function() {\n                    fileManager.currentFile('replace');\n                }\n            });\n            menuButtons.add({\n                name: 'next',\n                editorName: 'findnext',\n                originalAction: function() {\n                    fileManager.currentFile('next');\n                }\n            });\n            menuButtons.add({\n                name: 'fullscreen',\n                originalAction: function() {\n                    if (fullScreen) {\n                        rootObj.removeClass('vpl_ide_root_fullscreen');\n                        $('body').removeClass('vpl_body_fullscreen');\n                        menuButtons.setText('fullscreen', 'fullscreen');\n                        $('#vpl_ide_user').hide();\n                        fullScreen = false;\n                    } else {\n                        $('body').addClass('vpl_body_fullscreen').scrollTop(0);\n                        rootObj.addClass('vpl_ide_root_fullscreen');\n                        menuButtons.setText('fullscreen', 'regularscreen');\n                        if (options.username) {\n                            $('#vpl_ide_user').show();\n                        }\n                        fullScreen = true;\n                    }\n                    focusCurrentFile();\n                    setTimeout(autoResizeTab, 10);\n                },\n                bindKey: {\n                    win: 'Alt-F',\n                    mac: 'Ctrl-F'\n                }\n            });\n            menuButtons.add({\n                name: 'download',\n                originalAction: function() {\n                    window.location = options.download;\n                }\n            });\n            /**\n             * Reset files action\n             */\n            function resetFiles() {\n                VPLUI.requestAction('resetfiles', '', {}, options.ajaxurl)\n                .done(function(response) {\n                    var files = response.files;\n                    for (var fileName in files) {\n                        if (files.hasOwnProperty(fileName)) {\n                            fileManager.addFile(files[fileName], true, VPLUtil.doNothing, showErrorMessage);\n                        }\n                    }\n                    fileManager.fileListVisibleIfNeeded();\n                    VPLUtil.delay('updateMenu', updateMenu);\n                }).fail(showErrorMessage);\n            }\n            menuButtons.add({\n                name: 'resetfiles',\n                originalAction: function() {\n                    showMessage(str('sureresetfiles'), {\n                        title: str('resetfiles'),\n                        ok: resetFiles,\n                        icon: 'resetfiles'\n                    });\n                }\n            });\n            var noconfirmation = false;\n            menuButtons.add({\n                name: 'save',\n                originalAction: function() {\n                    var data = {\n                        files: fileManager.getFilesToSave(),\n                        comments: $('#vpl_ide_input_comments').val(),\n                        version: noconfirmation ? -1 : fileManager.getVersion()\n                    };\n                    if (JSON.stringify(data).length > options.postMaxSize) {\n                        showErrorMessage(str('maxpostsizeexceeded'));\n                        return;\n                    }\n                    /**\n                     * Save action\n                     */\n                    function doSave() {\n                        VPLUI.requestAction('save', 'saving', data, options.ajaxurl)\n                        .done(function(response) {\n                            if (response.requestsconfirmation && !noconfirmation) {\n                                var checkboxID = 'vpl_donotshowagain';\n                                var donotshowagain = '<input type=\"checkbox\" id=\"' + checkboxID + '\"'\n                                                    + ' class=\"align-text-bottom mr-1 mt-3\">'\n                                                    + '<label for=\"' + checkboxID + '\">' + str('donotshowagain') + '</label>';\n                                var $checkbox;\n                                showMessage(response.question + '<br>' + donotshowagain, {\n                                    title: str('saving'),\n                                    icon: 'alert',\n                                    yes: function() {\n                                        if ($checkbox.length == 1 && $checkbox.prop('checked')) {\n                                            noconfirmation = true;\n                                        }\n                                        data.version = 0;\n                                        doSave();\n                                    }\n                                });\n                                $checkbox = $('#' + checkboxID);\n                            } else {\n                                fileManager.resetModified();\n                                fileManager.setVersion(response.version);\n                                menuButtons.setTimeLeft(response);\n                                VPLUtil.delay('updateMenu', updateMenu);\n                                if (VPLUI.monitorRunning()) {\n                                    data.processid = VPLUtil.getProcessId();\n                                    VPLUI.requestAction('update', 'updating', data, options.ajaxurl);\n                                }\n                            }\n                        }).fail(showErrorMessage);\n                    }\n                    doSave();\n                },\n                bindKey: {\n                    win: 'Ctrl-S',\n                    mac: 'Command-S'\n                }\n            });\n\n            /**\n             * Launches the action\n             *\n             * @param {string} action Action 'run', 'debug', 'evaluate'\n             * @param {string} acting I18n for the action in progress\n             * @param {string} data Data attached to the action\n             */\n            function executionRequest(action, acting, data) {\n                if (!data) {\n                    data = {};\n                }\n                if (!lastConsole.isConnected()) {\n                    VPLUI.requestAction(action, '', data, options.ajaxurl)\n                    .done(function(response) {\n                        VPLUI.webSocketMonitor(response, action, acting, executionActions);\n                    })\n                    .fail(showErrorMessage);\n                }\n            }\n            /**\n             * Launches the run action\n             */\n            function runAction() {\n                executionRequest('run', 'running', {\n                    XGEOMETRY: VNCClient.getCanvasSize(),\n                    currentFileName: fileManager.getCurrentFileName(),\n                });\n            }\n            menuButtons.add({\n                name: 'run',\n                originalAction: function() {\n                    executionActions.setLastAction(runAction);\n                    runAction();\n                },\n                bindKey: {\n                    win: 'Ctrl-F11',\n                    mac: 'Command-U'\n                }\n            });\n            /**\n             * Launches the debug action\n             */\n            function debugAction() {\n                executionRequest('debug', 'debugging', {\n                    XGEOMETRY: VNCClient.getCanvasSize(),\n                    currentFileName: fileManager.getCurrentFileName(),\n                });\n            }\n            menuButtons.add({\n                name: 'debug',\n                originalAction: function() {\n                    executionActions.setLastAction(debugAction);\n                    debugAction();\n                },\n                bindKey: {\n                    win: 'Alt-F11',\n                    mac: 'Option-U'\n                }\n            });\n            /**\n             * Launches the evaluate action\n             */\n            function evaluateAction() {\n                executionRequest('evaluate', 'evaluating');\n            }\n            menuButtons.add({\n                name: 'evaluate',\n                originalAction: function() {\n                    executionActions.setLastAction(evaluateAction);\n                    evaluateAction();\n                },\n                bindKey: {\n                    win: 'Shift-F11',\n                    mac: 'Command-Option-U'\n                }\n            });\n            menuButtons.add({\n                name: 'comments',\n                originalAction: function() {\n                    dialogComments.dialog('open');\n                },\n            });\n            menuButtons.add({\n                name: 'console',\n                originalAction: function() {\n                    if (lastConsole.isOpen()) {\n                        lastConsole.close();\n                    } else {\n                        lastConsole.show();\n                    }\n                }\n            });\n            menuButtons.add({name: 'user'});\n            menuButtons.add({\n                name: 'about',\n                originalAction: function() {\n                    aboutDialog.dialog('open');\n                }\n            });\n            menuButtons.add({\n                name: 'timeleft',\n                originalAction: function() {\n                    menuButtons.toggleTimeLeft();\n                }\n            });\n            menuButtons.add({\n                name: 'more',\n                originalAction: function() {\n                    var tag = $('#vpl_ide_menuextra');\n                    if (tag.is(\":visible\")) {\n                        menuButtons.setText('more', 'more', VPLUtil.str('more'));\n                        tag.hide();\n                    } else {\n                        menuButtons.setText('more', 'less', VPLUtil.str('less'));\n                        tag.show();\n                    }\n                    VPLUtil.delay('updateMenu', updateMenu);\n                    VPLUtil.delay('autoResizeTab', autoResizeTab);\n                }\n            });\n            menuButtons.add({\n                name: 'shrightpanel',\n                icon: 'close-rightpanel',\n                originalAction: function() {\n                    if (resultContainer.vplVisible) {\n                        resultContainer.hide();\n                        resultContainer.vplVisible = false;\n                        menuButtons.setText('shrightpanel', 'open-rightpanel', VPLUtil.str('shrightpanel'));\n                    } else {\n                        menuButtons.setText('shrightpanel', 'close-rightpanel', VPLUtil.str('shrightpanel'));\n                        resultContainer.show();\n                        resultContainer.vplVisible = true;\n                    }\n                    VPLUtil.delay('autoResizeTab', autoResizeTab);\n                },\n                bindKey: {\n                    win: 'Ctrl-M',\n                    mac: 'Ctrl-M'\n                }\n            });\n            var rightpanelstyle = \"position:absolute;right:0;top:60px;z-index:100;margin:3px\";\n            tr.append('<span style=\"' + rightpanelstyle + '\">' + menuButtons.getHTML('shrightpanel') + '</span>');\n            var rightPanelButton = $('#vpl_ide_shrightpanel');\n            menuButtons.setText('shrightpanel', 'close-rightpanel', VPLUtil.str('shrightpanel'));\n\n            rightPanelButton.button();\n            rightPanelButton.css('padding', '0');\n            $('#vpl_ide_shrightpanel.ui-button-text').css('padding', '0');\n            rightPanelButton.on('click', function() {\n                menuButtons.launchAction('shrightpanel');\n            });\n            rightPanelButton.hide();\n            menu.addClass(\"ui-widget-header ui-corner-all\");\n            var menuHtml = \"\";\n            menuHtml += menuButtons.getHTML('more');\n            menuHtml += menuButtons.getHTML('save');\n            menuHtml += \"<span id='vpl_ide_mexecution'>\";\n            menuHtml += menuButtons.getHTML('run');\n            menuHtml += menuButtons.getHTML('debug');\n            menuHtml += menuButtons.getHTML('evaluate');\n            menuHtml += menuButtons.getHTML('comments');\n            menuHtml += menuButtons.getHTML('console');\n            menuHtml += \"</span> \";\n            menuHtml += \"<span id='vpl_ide_menuextra'>\";\n            menuHtml += \"<span id='vpl_ide_file'>\";\n            // TODO autosave not implemented.\n            menuHtml += menuButtons.getHTML('filelist');\n            menuHtml += menuButtons.getHTML('new');\n            menuHtml += menuButtons.getHTML('rename');\n            menuHtml += menuButtons.getHTML('delete');\n            menuHtml += menuButtons.getHTML('import');\n            menuHtml += menuButtons.getHTML('download');\n            menuHtml += menuButtons.getHTML('resetfiles');\n            menuHtml += menuButtons.getHTML('sort');\n            menuHtml += menuButtons.getHTML('multidelete');\n            menuHtml += menuButtons.getHTML('showparentfiles');\n            menuHtml += menuButtons.getHTML('fontsize');\n            menuHtml += menuButtons.getHTML('theme');\n            menuHtml += \"</span> \";\n            // TODO print still not implemented.\n            menuHtml += \"<span id='vpl_ide_edit'>\";\n            menuHtml += menuButtons.getHTML('undo');\n            menuHtml += menuButtons.getHTML('redo');\n            menuHtml += menuButtons.getHTML('select_all');\n            menuHtml += menuButtons.getHTML('find');\n            menuHtml += menuButtons.getHTML('find_replace');\n            menuHtml += menuButtons.getHTML('next');\n            menuHtml += \"</span> \";\n            menuHtml += \"</span> \";\n            menuHtml += menuButtons.getHTML('fullscreen') + ' ';\n            menuHtml += menuButtons.getHTML('about') + ' ';\n            menuHtml += menuButtons.getHTML('user') + ' ';\n            menuHtml += menuButtons.getHTML('timeleft');\n            menuHtml += '<div class=\"clearfix\"></div>';\n            menu.append(menuHtml);\n            $('#vpl_ide_more').button();\n            $('#vpl_ide_save').button();\n            $('#vpl_ide_menuextra').hide();\n            $('#vpl_ide_file').controlgroup();\n            $('#vpl_ide_edit').controlgroup();\n            $('#vpl_ide_mexecution').controlgroup();\n            $('#vpl_ide_fullscreen').button();\n            $('#vpl_ide_acetheme').button();\n            $('#vpl_ide_about').button();\n            $('#vpl_ide_user').button().css('float', 'right').hide();\n            $('#vpl_ide_timeleft').button().css('float', 'right').hide();\n            $('#vpl_menu .ui-button').css('padding', '6px');\n            $('#vpl_menu .ui-button-text').css('padding', '0');\n            var alwaysActive = ['filelist', 'more', 'fullscreen', 'about', 'resetfiles',\n                                'download', 'comments', 'console', 'import',\n                                'fontsize', 'timeleft'];\n            for (var i = 0; i < alwaysActive.length; i++) {\n                menuButtons.enable(alwaysActive[i], true);\n            }\n            menuButtons.setExtracontent('user', options.username);\n            menuButtons.setTimeLeft(options);\n            updateMenu = function() {\n                var i;\n                var file = fileManager.currentFile();\n                var nfiles = fileManager.length();\n                if (nfiles) {\n                    tabs.show();\n                } else {\n                    tabs.hide();\n                }\n                if (fileManager.isFileListVisible()) {\n                    menuButtons.setText('filelist', 'filelistclose', VPLUtil.str('filelist'));\n                } else {\n                    menuButtons.setText('filelist', 'filelist', VPLUtil.str('filelist'));\n                }\n                var modified = fileManager.isModified();\n                menuButtons.enable('save', modified);\n                var running = VPLUI.monitorRunning();\n                if (running) {\n                    menuButtons.setText('run', 'running');\n                } else {\n                    menuButtons.setText('run', 'run');\n                }\n                menuButtons.enable('run', !running && (!modified || options.example) && isOptionAllowed('run'));\n                menuButtons.enable('debug', !running && (!modified || options.example) && isOptionAllowed('debug'));\n                menuButtons.enable('evaluate', !running && (!modified || options.example) && isOptionAllowed('evaluate'));\n                menuButtons.enable('download', !modified);\n                menuButtons.enable('new', nfiles < maxNumberOfFiles);\n                menuButtons.enable('sort', nfiles - minNumberOfFiles > 1);\n                menuButtons.enable('multidelete', nfiles - minNumberOfFiles > 1);\n                menuButtons.enable('showparentfiles', !modified);\n                menuButtons.enable('theme', true);\n                var sel;\n                if (!file || nfiles === 0) {\n                    sel = ['rename', 'delete', 'undo', 'redo', 'select_all', 'find', 'find_replace', 'next'];\n                    for (i = 0; i < sel.length; i++) {\n                        menuButtons.enable(sel[i], false);\n                    }\n                    return;\n                }\n                menuButtons.enable('rename', file.getId() >= minNumberOfFiles && nfiles !== 0);\n                menuButtons.enable('delete', file.getId() >= minNumberOfFiles && nfiles !== 0);\n                menuButtons.enable('undo', file.hasUndo());\n                menuButtons.enable('redo', file.hasRedo());\n                menuButtons.enable('select_all', file.hasSelectAll());\n                menuButtons.enable('find', file.hasFind());\n                menuButtons.enable('find_replace', file.hasFindReplace());\n                menuButtons.enable('next', file.hasNext());\n                VPLUtil.delay('updateFileList', fileManager.updateFileList);\n            };\n\n            executionActions = {\n                'open': updateMenu,\n                'close': updateMenu,\n                'getConsole': function() {\n                    return lastConsole;\n                },\n                'setResult': self.setResult,\n                'ajaxurl': options.ajaxurl,\n                'run': function(content, coninfo, ws) {\n                    var parsed = /^([^:]*):?(.*)/.exec(content);\n                    var type = VPLUtil.sanitizeText(parsed[1]);\n                    if (type == 'terminal' || type == 'webterminal') {\n                        if (lastConsole && lastConsole.isOpen()) {\n                            lastConsole.close();\n                        }\n                        lastConsole = terminal;\n                        terminal.connect(coninfo.executionURL, function() {\n                            ws.close();\n                            focusCurrentFile();\n                        });\n                        if (type == 'webterminal') {\n                            var URLfavicon = (coninfo.secure ? \"https\" : \"http\") + \"://\" + coninfo.server + \":\" + coninfo.portToUse;\n                            URLfavicon += \"/favicon.ico\";\n                            var imgFavicon = $('<img>');\n                            imgFavicon.attr('src', URLfavicon);\n                            imgFavicon.attr('style', 'display:none');\n                            $('body').append(imgFavicon);\n                        }\n                    } else if (type == 'vnc') {\n                        if (lastConsole && lastConsole.isOpen()) {\n                            lastConsole.close();\n                        }\n                        lastConsole = VNCClient;\n                        VNCClient.connect(coninfo.secure, coninfo.server, coninfo.portToUse, coninfo.VNCpassword,\n                                coninfo.executionPath, function() {\n                                    ws.close();\n                                    focusCurrentFile();\n                                });\n                    } else if (type == \"browser\") {\n                        var URL = (coninfo.secure ? \"https\" : \"http\") + \"://\" + coninfo.server + \":\" + coninfo.portToUse + \"/\";\n                        URL += VPLUtil.sanitizeText(parsed[2]) + \"/httpPassthrough\";\n                        if (isTeacher) {\n                            URL += \"?private\";\n                        }\n                        var message = '<a href=\"' + URL + '\" target=\"_blank\">';\n                        message += VPLUtil.str('open') + '</a>';\n                        var options = {\n                            width: 200,\n                            icon: 'run',\n                            title: VPLUtil.str('run'),\n                        };\n                        showMessage(message, options);\n                    } else {\n                        VPLUtil.log(\"Type of run error \" + content, true);\n                    }\n                },\n                'lastAction': false,\n                'getLastAction': function() {\n                    var ret = this.lastAction;\n                    this.lastAction = false;\n                    return ret;\n                },\n                'setLastAction': function(action) {\n                    this.lastAction = action;\n                }\n            };\n\n            tabs.on(\"tabsactivate\", function() {\n                fileManager.currentFile('focus');\n                VPLUtil.delay('updateMenu', updateMenu);\n                VPLUtil.delay('autoResizeTab', autoResizeTab);\n            });\n\n            // VPLIDE resize view control.\n            var jw = $(window);\n            jw.on('resize', autoResizeTab);\n            // Save? before exit.\n            if (!options.example) {\n                jw.on('beforeunload', function() {\n                    if (fileManager.isModified()) {\n                        return str('changesNotSaved');\n                    }\n                    return undefined;\n                });\n            }\n            fileManager = new FileManager();\n\n            autoResizeTab();\n            // Checks menu width every 1 sec as it can change without event.\n            (function() {\n                var oldMenuWidth = menu.width();\n                /**\n                 * Checks menu width change\n                 */\n                function checkMenuWidth() {\n                    var newMenuWidth = menu.width();\n                    if (oldMenuWidth != newMenuWidth) {\n                        oldMenuWidth = newMenuWidth;\n                        autoResizeTab();\n                    }\n                }\n                checkMenuWidth();\n                setInterval(checkMenuWidth, 1000);\n            }());\n            fileManager.resetModified();\n            VPLUI.requestAction('load', 'loading', options, options.loadajaxurl)\n            .done(function(response) {\n                var allOK = true;\n                var files = response.files;\n                var showFileList = false;\n                for (var i = 0; i < files.length; i++) {\n                    var file = files[i];\n                    var r = fileManager.addFile(file, false, updateMenu, showErrorMessage);\n                    if (r) {\n                        r.resetModified();\n                        if (i < minNumberOfFiles || files.length <= 5) {\n                            fileManager.open(r);\n                        } else {\n                            showFileList = true;\n                        }\n                    } else {\n                        allOK = false;\n                    }\n                }\n                tabs.tabs('option', 'active', 0);\n                if (response.compilationexecution) {\n                    self.setResult(response.compilationexecution, false);\n                }\n                menuButtons.setTimeLeft(response);\n                if (response.comments > '') {\n                    $('#vpl_ide_input_comments').val(response.comments);\n                }\n                if (allOK) {\n                    fileManager.resetModified();\n                } else {\n                    fileManager.setModified();\n                }\n                if (fileManager.length() === 0 && maxNumberOfFiles > 0) {\n                    menuButtons.getAction('new')();\n                } else if (!options.saved) {\n                    fileManager.setModified();\n                }\n                fileManager.setFontSize(options.fontSize);\n                fileManager.setVersion(response.version);\n                fileManager.fileListVisible(showFileList);\n                VPLUtil.afterAll('AfterLoadFiles', function() {\n                    updateMenu();\n                    autoResizeTab();\n                    adjustTabsTitles(true);\n                    if (fileManager.length() > 0) {\n                        var file = fileManager.getFiles()[0];\n                        file.open();\n                        file.focus();\n                    }\n                });\n            })\n            .fail(showErrorMessage);\n        };\n        window.VPLIDE = VPLIDE;\n        return {\n            init: function(rootId, options) {\n                vplIdeInstance = new VPLIDE(rootId, options);\n            }\n        };\n    }\n);\n"],"names":["define","$","jqui","coreURL","VPLUtil","VPLUI","VPLFile","VPLIDEButtons","VPLTerminal","VPLVNCClient","VPLIDE","vplIdeInstance","rootId","options","fileManager","adjustTabsTitles","autoResizeTab","showErrorMessage","updateMenu","executionActions","self","this","minNumberOfFiles","minfiles","maxNumberOfFiles","maxfiles","restrictedEdit","restrictededitor","example","readOnly","readOnlyFiles","isTeacher","fullScreen","scrollBarWidth","str","rootObj","append","relativeUrl","Error","activateModification","optionsToCheck","new","rename","delete","save","run","edit","debug","evaluate","import","resetfiles","sort","multidelete","showparentfiles","acetheme","console","comments","loadajaxurl","ajaxurl","isOptionAllowed","op","dragoverHandler","e","originalEvent","dataTransfer","dropEffect","preventDefault","dropHandler","stopImmediatePropagation","droppedFiles","listDroppedFiles","entry","path","arguments","length","undefined","Promise","resolve","isFile","file","fullName","name","Object","defineProperty","get","push","isDirectory","createReader","readEntries","entries","dirPromises","i","all","then","catch","err","log","dt","promises","items","webkitGetAsEntry","getAsFile","callback","files","readSelectedFiles","addFile","fileListVisibleIfNeeded","restrictedPaste","stopPropagation","fontSize","parseInt","on","menu","menuButtons","tr","fileListContainer","fileList","fileListContent","tabsUl","tabs","resultContainer","result","renameDiretoryAction","doNothing","vplMinWidth","updateEvaluationNumber","res","nevaluations","text","reductionbyevaluation","freeevaluations","setExtracontent","lastResult","getTerminal","terminal","setResultGrade","content","raw","titleclass","find","titleTag","replaceWith","setResultTab","contentclass","contentTag","HTMLcontent","contents","html","applyMathJax","window","MathJax","math","Hub","Queue","startup","promise","typesetPromise","setResult","go","getFiles","fileNames","getFileName","clearAnnotations","hasContent","gradeShow","formated","show","grade","sanitizeText","variables","processResult","compilation","evaluation","execution","VPLDescription","vplVisible","accordion","anot","getAnnotations","j","type","gotoFile","row","hide","delay","heightStyle","header","animate","beforeActivate","event","ui","newHeader","hasClass","width","gotoFileLink","currentTarget","addClass","iconFolder","tabsAir","getTabsAir","outerWidth","resizeTabWidth","maxWidth","diffLeft","position","left","originalPosition","resizable","vplOriginalWidth","diffWidth","size","originalSize","currentFile","resizableOptions","containment","resize","start","off","stop","handles","focusCurrentFile","center","newWidth","tabsUlWidth","last","children","parentScrollLeft","parent","scrollLeft","fileTab","getTabNameId","scroll","finish","index","oldWidth","planb","disable","css","right","rel","wfl","newHeight","outerHeight","offset","top","height","panelHeight","resizeHeight","dialogbaseOptions","extend","close","showMessage","message","dialogNew","newFileHandler","keyCode","dialog","val","encoding","newfile","open","getTabPos","getId","focus","dialogButtons","title","buttons","setDialogTitleIcon","dialogRename","renameHandler","renameFile","dialogRenameDirectory","renameDirectoryHandler","renameDirectory","target","hasAttribute","dirname","getAttribute","dialogComments","oldStudentComments","setModified","aboutDialog","OKButtons","shortcutDialog","getShortcuts","next","filter","button","dialogSort","dialogSortButtons","regNoNumber","sorted","newOrder","each","orig","id","replace","list","sortable","placeholder","item","removeClass","disableSelection","maxHeight","dialogMultidelete","dialogMultideleteButtons","prop","toDeleteList","label","data","deleteFile","updateFileList","dialogFontsize","fontsizeSlider","dialogFontFizeButtons","value","slider","setFontSize","setUserPreferences","getFontSize","min","max","change","dialogAceTheme","acethemeSelect","dialogAceThemeButtons","setTheme","aceTheme","modal","getTheme","VNCClient","lastConsole","fileSelect","resetFiles","requestAction","done","response","fileName","hasOwnProperty","fail","add","originalAction","fileListVisible","isFileListVisible","bindKey","win","mac","filename","ok","icon","closeFile","trigger","openpopup","url","showparentfilesurl","Math","screen","availWidth","availHeight","print","editorName","setText","scrollTop","username","setTimeout","location","download","noconfirmation","executionRequest","action","acting","isConnected","webSocketMonitor","runAction","XGEOMETRY","getCanvasSize","currentFileName","getCurrentFileName","debugAction","evaluateAction","getFilesToSave","version","getVersion","JSON","stringify","postMaxSize","doSave","requestsconfirmation","$checkbox","donotshowagain","question","yes","resetModified","setVersion","setTimeLeft","monitorRunning","processid","getProcessId","setLastAction","isOpen","toggleTimeLeft","tag","is","getHTML","rightPanelButton","launchAction","menuHtml","controlgroup","alwaysActive","enable","nfiles","modified","isModified","sel","running","hasUndo","hasRedo","hasSelectAll","hasFind","hasFindReplace","hasNext","getConsole","coninfo","ws","parsed","exec","connect","executionURL","URLfavicon","secure","server","portToUse","imgFavicon","attr","VNCpassword","executionPath","URL","lastAction","getLastAction","ret","jw","openFiles","fileNameIncluded","checkName","toLowerCase","nameMod","indexOf","twoBlockly","oldname","newname","isBlockly","v","generateFileList","fileNameExists","localClipboard","setClipboard","t","getClipboard","fileId","theme","addTab","fid","hlink","removeTab","remove","isReadOnly","pos","setGetkeys","hideIDEStatus","ptab","splice","getFilePosById","isClosed","b","showError","validPath","setContent","getUniqueId","extendToBinary","extendToBlockly","extendToCodeEditor","setFileName","isBinary","fileExtension","getContent","gotoFileName","directoryExists","dirName","startsWith","oldName","newName","oldNameLength","checkDirName","newFileNames","substr","oldNames","fun","args","Array","prototype","slice","shift","apply","currentPos","getFileTab","l","gotoLine","a","fname","fpos","line","getFile","getDirectoryStructure","structure","isDir","addFilePath","split","curdir","pathdir","p","part","lines","lister","dir","indent","fd","sname","attrs","dirline","iconModified","iconReadOnly","iconRequired","getAction","oldMenuWidth","checkMenuWidth","newMenuWidth","setInterval","allOK","showFileList","r","compilationexecution","saved","afterAll","init"],"mappings":"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"}